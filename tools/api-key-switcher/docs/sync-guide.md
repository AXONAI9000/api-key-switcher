# API Key Switcher 同步功能使用指南

## 概述

同步功能允许您在多台设备之间安全地同步 API Key 配置。所有数据在客户端使用 AES-256-GCM 加密后才会上传，服务器无法解密您的数据（零知识存储）。

## 支持的同步后端

### 1. 自建服务器

最安全的选择，完全掌控您的数据。

**优点：**
- 完全控制数据存储
- 可自定义安全策略
- 无第三方依赖

**配置步骤：**

1. 部署同步服务器（参见 `tools/api-key-sync-server/README.md`）
2. 在应用中打开同步设置
3. 选择"自建服务器"
4. 输入服务器地址和访问令牌
5. 点击"测试连接"验证配置

### 2. GitHub Gist

使用 GitHub 的私有 Gist 存储加密配置。

**优点：**
- 无需部署服务器
- 免费使用
- 可靠的基础设施

**配置步骤：**

1. 创建 GitHub Personal Access Token：
   - 访问 https://github.com/settings/tokens/new
   - 勾选 `gist` 权限
   - 生成并复制 Token

2. 在应用中打开同步设置
3. 选择"GitHub Gist"
4. 粘贴 Token
5. 点击"测试连接"

**注意：** 首次同步会自动创建一个私有 Gist。

### 3. WebDAV

支持任何 WebDAV 兼容的云存储服务。

**支持的服务：**
- 坚果云
- Nextcloud
- Box
- 其他 WebDAV 服务

**坚果云配置：**

1. 登录坚果云网页版
2. 进入"账户信息" → "安全选项"
3. 添加应用密码
4. 在应用中选择"WebDAV"
5. 选择预设"坚果云"
6. 输入用户名和应用密码

## 主密码

主密码用于加密您的配置数据。

**重要提示：**
- 主密码不会上传到服务器
- 丢失主密码将无法恢复数据
- 建议使用强密码（8+ 字符，包含大小写字母、数字和特殊字符）

## 同步操作

### 手动同步

- **拉取**：从服务器下载最新配置
- **推送**：将本地配置上传到服务器
- **同步**：双向同步（推荐）

### 自动同步

启用后，应用会按设定的间隔自动同步配置。

**建议间隔：**
- 频繁修改：5-15 分钟
- 偶尔修改：30-60 分钟

## 冲突解决

当本地和服务器配置都有修改时，会出现冲突。

**解决选项：**

1. **使用本地版本**：覆盖服务器上的配置
2. **使用服务器版本**：覆盖本地配置
3. **智能合并**（推荐）：合并两边的 Key，保留最新的

## 安全说明

1. **端到端加密**：使用 AES-256-GCM 加密，PBKDF2 密钥派生
2. **零知识存储**：服务器只存储加密数据，无法解密
3. **本地密钥**：加密密钥从主密码派生，不会离开设备
4. **传输安全**：建议使用 HTTPS 连接

## 故障排除

### 连接失败

1. 检查网络连接
2. 验证服务器地址是否正确
3. 确认访问令牌有效
4. 检查防火墙设置

### 同步失败

1. 确认主密码正确
2. 检查服务器状态
3. 尝试手动推送/拉取

### 解密失败

1. 确认使用正确的主密码
2. 数据可能已损坏，尝试使用本地版本覆盖

## 常见问题

**Q: 更换设备后如何恢复配置？**

A: 在新设备上配置相同的同步后端，输入相同的主密码，然后执行"拉取"操作。

**Q: 可以同时使用多个同步后端吗？**

A: 目前只支持一个活动的同步后端。

**Q: 主密码可以修改吗？**

A: 目前不支持修改主密码。如需更改，请先导出配置，删除同步数据，然后重新设置。

**Q: 同步数据占用多少空间？**

A: 通常只有几 KB，取决于您保存的 Key 数量。
